# 输入一个URL到页面过程中发生了什么

## 输入地址

浏览器智能匹配url，搜索历史记录，书签等，给出提示，如果有记录，还可以从缓存中展示网页

## DNS查找域名对应的IP

- 系统会先去找缓存，没有的话往下
- 检查hosts，没有的话往下
- 访问局部DNS服务，这个过程叫递归，没有记录的话往下
- 局部DNS查询根域名DNS 服务器，返回顶级域名服务器的ip，局部DNS再依次查询，直到有结果，这个过程叫迭代

> 如果配置了负载均衡，每次返回的ip可能会不同

## 浏览器向web服务器发送请求

拿到ip后浏览器会发起TCP连接请求，期间会经过网卡，协议栈，防火墙，然后进行三次握手

连接后发起一个http请求，包含请求方法，协议版本，请求头，请求正文

## 重定向

比如输入了`google.com`，会被重定向到`www.google.com`

有利于SEO以及缓存

## 服务器处理请求

nginx反向代理 - 负载均衡

http响应 - 状态行、响应头、响应正文

相应头到达浏览器后有些参数需要注意：

Set-Cookie,Refresh,Last-Modified,Expires,Content-Type,Allow

## 浏览器显示HTML

解析HTML构建DOM树，解析CSS构建渲染树，渲染树构建完成后就会开始布局和绘制，这里涉及回流和重绘

- dom需要浏览器计算位置和大小，这叫reflow重排或回流
- 颜色，字体等确定后浏览器开始绘制内容，这叫做重绘repain

文档解析遇到js文件会阻塞渲染，因此一般将js放在文件末尾

js解析是由浏览器的js引擎完成的，如谷歌中是v8

## 获取html中的资源

如图片视频css等资源，浏览器会重新发起请求获取

